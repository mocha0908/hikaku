<!DOCTYPE html>

<html lang="ja">

<head>

  <meta charset="UTF-8">

  <title>ãƒˆãƒ¬ã‚«ã‚­ãƒ³ã‚°ãƒ€ãƒ  è²·å–æ¯”è¼ƒ</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700;900&family=Roboto:wght@500;700;900&display=swap" rel="stylesheet">

  <style>

    /* CSSã¯ãã®ã¾ã¾ */

    :root {

      --primary: #0066cc;

      --primary-light: #e6f0ff;

      --accent: #e60012;

      --accent-bg: #fff0f0;

      --bg: #f0f2f5;

      --card-bg: #ffffff;

      --text: #222;

      --text-sub: #555;

      --border: #dfe3e8;

      --radius: 12px;

      --shadow: 0 2px 8px rgba(0,0,0,0.06);

      --f-size: 15px; 

      --search-height: 76px;

    }



    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body { font-family: 'Noto Sans JP', sans-serif; margin: 0; padding: 0; background: var(--bg); color: var(--text); padding-bottom: 80px; }



    header { background: #fff; padding: 16px 20px; text-align: center; box-shadow: 0 1px 3px rgba(0,0,0,0.05); position: relative; z-index: 20; }

    h1 { margin: 0; font-size: 22px; color: var(--primary); font-weight: 900; letter-spacing: 0.05em; }

    h1 span { color: var(--text); font-size: 15px; font-weight: normal; margin-left: 8px; }



    .search-sticky { position: sticky; top: 0; z-index: 100; background: rgba(240, 242, 245, 0.95); backdrop-filter: blur(10px); padding: 12px 16px; border-bottom: 1px solid rgba(0,0,0,0.05); height: var(--search-height); display: flex; align-items: center; justify-content: center; }

    .search-bar { display: flex; gap: 8px; width: 100%; max-width: 900px; margin: 0 auto; }

    .input-wrapper { position: relative; flex: 1; display: flex; align-items: center; background: #fff; border-radius: 50px; border: 1px solid var(--border); box-shadow: 0 2px 6px rgba(0,0,0,0.05); transition: all 0.2s; padding-right: 6px; }

    .input-wrapper:focus-within { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(0,102,204,0.1); }

    .input-wrapper input { border: none; background: transparent; padding: 12px 20px; font-size: 16px; flex: 1; outline: none; border-radius: 50px; }

    .btn-copy-input { border: none; background: transparent; cursor: pointer; font-size: 20px; padding: 8px 14px; color: #bbb; transition: color 0.2s; line-height: 1; display: flex; align-items: center; }

    .btn-copy-input:hover { color: var(--primary); }

    .btn-search { width: 48px; height: 48px; border-radius: 50%; border: none; background: var(--primary); color: #fff; cursor: pointer; display: flex; align-items: center; justify-content: center; flex-shrink: 0; box-shadow: 0 2px 6px rgba(0,102,204,0.3); }

    .btn-search:active { transform: scale(0.95); }

    .btn-search svg { width: 24px; height: 24px; fill: white; }



    .controls-area { max-width: 1200px; margin: 0 auto; padding: 16px; }

    .filter-scroll { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 8px; -webkit-overflow-scrolling: touch; scrollbar-width: none; align-items: center; white-space: nowrap; margin-bottom: 12px;}

    .filter-scroll::-webkit-scrollbar { display: none; }

    

    .chip { white-space: nowrap; padding: 0 16px; border-radius: 24px; background: #fff; border: 1px solid var(--border); color: var(--text-sub); font-size: 14px; font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 6px; height: 44px; flex-shrink: 0; }

    .chip.active { background: var(--primary); color: #fff; border-color: var(--primary); box-shadow: 0 2px 6px rgba(0,102,204,0.25); }

    .chip select { border: none; background: transparent; color: inherit; font: inherit; outline: none; padding-right: 4px; cursor: pointer; height: 100%; font-size: 14px; }

    .chip select option { color: #333; }

    .chip input.direct-input { border: none; background: transparent; outline: none; color: inherit; width: 90px; font-size: 14px; font-weight: 500; height: 100%; }

    .chip input.direct-input::placeholder { color: #aaa; font-weight: normal; }

    .chip.active input.direct-input::placeholder { color: rgba(255,255,255,0.7); }



    details.guarantee-box { background: #fff; border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; margin-bottom: 20px; }

    details.guarantee-box summary { padding: 14px 20px; font-weight: 700; font-size: 14px; color: var(--primary); cursor: pointer; outline: none; display: flex; align-items: center; justify-content: space-between; }

    details.guarantee-box summary::after { content: "â–¼"; font-size: 12px; opacity: 0.5; }

    details.guarantee-box[open] summary::after { content: "â–²"; }

    

    .g-table { width:100%; font-size:13px; border-collapse:collapse; text-align:center; }

    .g-table th { padding:12px 8px; border:1px solid #dfe3e8; background:#e9ecef; color:#333; font-weight:bold; }

    .g-table td { padding:10px; border:1px solid #eee; }

    .g-title-cell { text-align:left; font-weight:bold; color:#0066cc; background:#fafafa; }



    .spinner { display: none; flex-direction: column; align-items: center; gap: 12px; padding: 40px; color: var(--text-sub); font-size: 14px; }

    .spinner-circle { width: 40px; height: 40px; border: 4px solid #eee; border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }

    @keyframes spin{to{transform:rotate(360deg)}}



    .price { font-family: 'Roboto', sans-serif; font-weight: 700; letter-spacing: -0.5px; font-size: calc(var(--f-size) + 2px); }

    .price-yen { font-size: 0.8em; margin-right: 1px; font-weight: normal; }

    .price-empty { color: #ccc; font-size: calc(var(--f-size) - 2px); }

    

    .btn-copy { display: inline-flex; align-items: center; justify-content: center; margin-left: 8px; padding: 4px 10px; border-radius: 6px; background: #f0f2f5; color: #0066cc; border: 1px solid #ccd; font-size: 12px; cursor: pointer; vertical-align: middle; user-select: none; white-space: nowrap; flex-shrink: 0; font-weight: 500; }

    .btn-copy:active { transform: scale(0.95); background: #eef; }

    

    .clickable-price { cursor: pointer; position: relative; transition: color 0.1s; }

    .clickable-price:hover { color: var(--primary); text-decoration: underline; }



    .card-grid { display: grid; gap: 16px; }

    .card { background: #fff; border-radius: var(--radius); box-shadow: var(--shadow); overflow: hidden; display: grid; grid-template-columns: 90px 1fr; position: relative; }

    .card-img { grid-row: 1 / -1; width: 100%; height: 100%; background: #fafafa; display: flex; align-items: center; justify-content: center; cursor: zoom-in; }

    .card-img img { width: 100%; height: 100%; object-fit: contain; padding: 6px; }

    .card-body { padding: 12px 16px; display: flex; flex-direction: column; gap: 10px; }

    

    .card-title { font-size: var(--f-size); font-weight: 700; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }

    .king-prices { display: grid; grid-template-columns: repeat(5, 1fr); gap: 6px; background: var(--primary-light); border-radius: 8px; padding: 8px; }

    .kp-item { text-align: center; display: flex; flex-direction: column; }

    .kp-label { font-size: 10px; color: var(--primary); font-weight: bold; margin-bottom: 2px; }

    .kp-val { font-size: calc(var(--f-size) - 2px); color: #333; font-weight: 700; }



    .rush-row { grid-column: 1 / -1; border-top: 1px dashed var(--border); padding: 10px 16px; display: flex; align-items: center; justify-content: space-between; background: #fffbfc; }

    .rush-label { font-size: calc(var(--f-size) - 3px); color: var(--accent); font-weight: bold; }

    .rush-val { font-size: calc(var(--f-size) + 4px); color: var(--accent); font-weight: 900; }



    @media (min-width: 768px) {

      .card-grid { display: none; }

      .desktop-table-wrap { display: block !important; background: #fff; border-radius: var(--radius); box-shadow: var(--shadow); overflow: visible; border: 1px solid #eee; }

      table.res-tbl { width: 100%; border-collapse: separate; border-spacing: 0; font-size: var(--f-size); }

      table.res-tbl th { background: #f8f9fa; padding: 16px 12px; text-align: center; font-weight: 700; color: #555; border-bottom: 2px solid #ddd; position: sticky; top: var(--search-height); z-index: 10; white-space: nowrap; }

      table.res-tbl td { padding: 14px 12px; text-align: center; border-bottom: 1px solid #eee; vertical-align: middle; }

      table.res-tbl tr:hover { background: #f0f7ff; }

      table.res-tbl th:first-child { text-align: left; }

      table.res-tbl td:first-child { text-align: left; font-weight: bold; color: #333; line-height: 1.6; }

      .rush-col { background: var(--accent-bg); border-left: 2px solid #ffdede; color: var(--accent); font-weight: bold; font-size: calc(var(--f-size) + 2px); }

      th.rush-header { background: #ffebeb; color: var(--accent); border-left: 2px solid #ffdede; }

      img.tbl-thumb { width: 50px; height: 50px; object-fit: contain; border-radius: 4px; border: 1px solid #eee; }

    }

    .desktop-table-wrap { display: none; }



    mark { background: rgba(255, 213, 0, 0.4); color: inherit; padding: 0; }

    .pager { display: flex; justify-content: center; gap: 10px; margin-top: 30px; }

    .pager btn { width: 40px; height: 40px; border-radius: 10px; border: 1px solid var(--border); background: #fff; display: flex; align-items: center; justify-content: center; cursor: pointer; color: var(--text-sub); font-size: 16px; }

    .pager btn:hover { background: #f0f0f0; }

    .pager btn.disabled { opacity: 0.4; pointer-events: none; }



    #modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.85); z-index: 9999; align-items: center; justify-content: center; backdrop-filter: blur(4px); }

    #modal img { max-width: 90%; max-height: 90%; border-radius: 8px; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }

    

    #toast { position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%) translateY(20px); background: #222; color: #fff; padding: 12px 24px; border-radius: 30px; font-size: 14px; opacity: 0; visibility: hidden; transition: all 0.3s; z-index: 10000; box-shadow: 0 6px 16px rgba(0,0,0,0.3); font-weight: 500; }

    #toast.show { opacity: 1; visibility: visible; transform: translateX(-50%) translateY(0); }

  </style>

</head>

<body>



  <header><h1>ãƒˆãƒ¬ã‚«ã‚­ãƒ³ã‚°ãƒ€ãƒ  <span>è²·å–æ¯”è¼ƒæ¤œç´¢</span></h1></header>



  <div class="search-sticky">

    <div class="search-bar">

      <div class="input-wrapper">

        <input type="text" id="keyword" placeholder="ã‚«ãƒ¼ãƒ‰åãƒ»å‹ç•ª (ã‚¹ãƒšãƒ¼ã‚¹=AND)" enterkeyhint="search">

        <button class="btn-copy-input" onclick="copyKeyword()" title="ã‚³ãƒ”ãƒ¼">ğŸ“‹</button>

      </div>

      <button class="btn-search" onclick="search()">

        <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 3 13.09 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>

      </button>

    </div>

  </div>



  <div class="controls-area">

    <div class="filter-scroll">

      <div class="chip">ğŸ“‚ <select id="categorySelect"><option value="">å…¨ã‚«ãƒ†ã‚´ãƒª</option></select></div>

      <div class="chip" id="thresholdChip">ğŸš« <input type="number" id="thresholdInput" class="direct-input" placeholder="ä¸‹é™ãªã—(å††)"></div>

      <div class="chip" onclick="toggleSort()"><span id="sortIcon">â‡…</span> <span id="sortLabel">æ¨™æº–(åå‰é †)</span></div>

      <div class="chip">Aa <select id="fontSizeSelect"><option value="13px">å°</option><option value="15px" selected>ä¸­</option><option value="17px">å¤§</option><option value="20px">ç‰¹å¤§</option></select></div>

      <div class="chip">ğŸ“„ <select id="pageSizeSelect"><option value="50">50ä»¶</option><option value="100" selected>100ä»¶</option><option value="200">200ä»¶</option><option value="all">å…¨ä»¶</option></select></div>

    </div>



    <div class="filter-scroll" id="initialBar"></div>



    <details class="guarantee-box">

      <summary>âš¡ æœ€ä½ä¿è¨¼ä¾¡æ ¼è¡¨ã‚’ç¢ºèªã™ã‚‹</summary>

      <div style="overflow-x:auto; padding:0 16px 16px;">

        <table class="g-table">

          <thead>

            <tr><th>ã‚«ãƒ¼ãƒ‰</th><th>A</th><th>A-</th><th>B</th><th>C</th><th>D</th></tr>

          </thead>

          <tbody>

            <tr><td class="g-title-cell">PSA10ä¿è¨¼</td><td>Â¥5,000</td><td>Â¥4,000</td><td>Â¥3,000</td><td>Â¥2,000</td><td>Â¥1,000</td></tr>

            <tr><td class="g-title-cell">SARä¿è¨¼</td><td>Â¥400</td><td>Â¥300</td><td>Â¥200</td><td>Â¥100</td><td>Â¥50</td></tr>

            <tr><td class="g-title-cell">ARä¿è¨¼</td><td>Â¥220</td><td>Â¥150</td><td>Â¥70</td><td>Â¥30</td><td>Â¥10</td></tr>

          </tbody>

        </table>

      </div>

    </details>



    <div id="spinner" class="spinner">

      <div class="spinner-circle"></div><span>ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã¦ã„ã¾ã™...</span>

    </div>



    <div id="result-container">

      <div id="cardView" class="card-grid"></div>

      <div id="tableView" class="desktop-table-wrap"></div>

      <div id="pager" class="pager"></div>

    </div>

  </div>



  <div id="modal" onclick="this.style.display='none'"><img id="modalImage" src=""></div>

  <div id="toast">âœ… <span id="toastMsg"></span></div>



  <script>

    // â–¼â–¼â–¼ ã‚ãªãŸã®GASã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªURLã«æ›¸ãæ›ãˆã¦ãã ã•ã„ â–¼â–¼â–¼

    const API_URL = "https://script.google.com/macros/s/AKfycbwXJ4In8PMlrW_NKomGLn3wo2myFIPl4HtlAIZ2z1ZPrSkz-eXL_aXKqXcaY-KWPnSj/exec"; 

    // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²



    const state = {

      rows: [], page: 1, pageSize: 100,

      sort: { idx: 0, dir: 'asc' },

      terms: { andTerms:[], orTerms:[] },

      thresholdA: null, initialKey: 'ALL'

    };

    

    const INITIALS = [

      {k:'ALL',l:'å…¨ã¦'}, {k:'A',l:'ã‚'}, {k:'K',l:'ã‹'}, {k:'S',l:'ã•'}, {k:'T',l:'ãŸ'},

      {k:'N',l:'ãª'}, {k:'H',l:'ã¯'}, {k:'M',l:'ã¾'}, {k:'Y',l:'ã‚„'}, {k:'R',l:'ã‚‰'}, {k:'W',l:'ã‚'}, {k:'MISC',l:'ä»–'}

    ];



    document.addEventListener('DOMContentLoaded', () => {

      // ã‚«ãƒ†ã‚´ãƒªå–å¾—

      fetch(API_URL + "?action=categories")

        .then(r => r.json())

        .then(list => {

          const sel = document.getElementById('categorySelect');

          list.forEach(c => { const opt = document.createElement('option'); opt.value = c; opt.innerText = c; sel.appendChild(opt); });

        })

        .catch(e => console.error("Category Load Error", e));



      buildInitialBar();

      setupUI();

      search(); // åˆæœŸãƒ­ãƒ¼ãƒ‰

      

      document.getElementById('keyword').addEventListener('keydown', e => { 

        if(e.key === 'Enter'){

          if(e.target.value.trim() === '') return;

          search(); 

        }

      });

      document.getElementById('categorySelect').addEventListener('change', () => search());

      document.getElementById('pageSizeSelect').addEventListener('change', e => {

        state.pageSize = e.target.value==='all' ? Infinity : Number(e.target.value);

        state.page = 1; render();

      });

    });



    function setupUI(){

      const fSize = localStorage.getItem("tk_f") || "15px";

      document.documentElement.style.setProperty('--f-size', fSize);

      document.getElementById('fontSizeSelect').value = fSize;

      document.getElementById('fontSizeSelect').addEventListener('change', e => {

        const v = e.target.value;

        document.documentElement.style.setProperty('--f-size', v);

        localStorage.setItem("tk_f", v);

      });



      const tInput = document.getElementById('thresholdInput');

      const sThr = localStorage.getItem("tk_t");

      if(sThr) { 

        tInput.value = sThr; 

        state.thresholdA = Number(sThr);

        document.getElementById('thresholdChip').classList.add('active');

      }



      tInput.addEventListener('input', (e) => {

         const val = e.target.value;

         if(val && Number(val) > 0) {

           state.thresholdA = Number(val);

           document.getElementById('thresholdChip').classList.add('active');

         } else {

           state.thresholdA = null;

           document.getElementById('thresholdChip').classList.remove('active');

         }

         localStorage.setItem("tk_t", val);

         render();

      });

    }



    function search(){

      const kw = document.getElementById('keyword').value;

      const cat = document.getElementById('categorySelect').value;

      const spinner = document.getElementById('spinner');

      

      spinner.style.display = 'flex';

      document.getElementById('cardView').innerHTML = '';

      document.getElementById('tableView').innerHTML = '';

      document.getElementById('pager').innerHTML = '';



      state.terms = parseQuery(kw);



      // GASã¸ã®ãƒ‡ãƒ¼ã‚¿å•ã„åˆã‚ã› (fetch)

      const targetUrl = `${API_URL}?action=search&keyword=${encodeURIComponent(kw)}&category=${encodeURIComponent(cat)}`;

      

      fetch(targetUrl)

        .then(res => res.json())

        .then(data => {

            spinner.style.display = 'none';

            state.rows = data.rows || [];

            state.page = 1;

            state.sort = { idx: 0, dir: 'asc' }; 

            

            if(state.rows.length === 0) {

              if(!kw && !cat) {

                document.getElementById('cardView').innerHTML = 

                  `<div style="text-align:center; padding:60px 20px; color:#aaa;">

                      <div style="font-size:40px; margin-bottom:10px;">ğŸ”</div>

                      <div>ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹ã‹ã€<br>ã‚«ãƒ†ã‚´ãƒªã‚’é¸æŠã—ã¦æ¤œç´¢ã—ã¦ãã ã•ã„</div>

                    </div>`;

              } else {

                document.getElementById('cardView').innerHTML = 

                  `<div style="text-align:center; padding:40px; color:#999; font-size:15px;">æ¡ä»¶ã«ä¸€è‡´ã™ã‚‹ã‚«ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ</div>`;

              }

            } else {

              render();

            }

        })

        .catch(e => {

            spinner.style.display = 'none';

            alert('ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼: ' + e.message);

        });

    }



    function filterRows(){

      let res = state.rows;

      if(state.thresholdA !== null) {

        res = res.filter(r => { const p = Number(r[2]); return isNaN(p) || p >= state.thresholdA; });

      }

      if(state.initialKey !== 'ALL') {

        res = res.filter(r => getInitialGroup(r[0]) === state.initialKey);

      }

      const { idx, dir } = state.sort;

      res.sort((a,b) => {

        const va = a[idx], vb = b[idx];

        const isNum = idx >= 2; 

        if(isNum) return ( (Number(va)||0) - (Number(vb)||0) ) * (dir==='asc'?1:-1);

        return String(va||"").localeCompare(String(vb||""), 'ja') * (dir==='asc'?1:-1);

      });

      return res;

    }



    function render(){

      const all = filterRows();

      const total = all.length;

      const size = state.pageSize;

      const maxPage = Math.ceil(total / size) || 1;

      if(state.page > maxPage) state.page = 1;

      

      const start = (state.page - 1) * size;

      const end = Math.min(start + size, total);

      const viewRows = all.slice(start, end);

      

      renderMobile(viewRows);

      renderDesktop(viewRows);

      renderPager(state.page, maxPage);

    }



    function renderMobile(rows){

      const container = document.getElementById('cardView');

      let html = '';

      

      rows.forEach(r => {

        const [name, img, pA, pAm, pB, pC, pD, pRush] = r;

        const imgTag = (img && /^http/.test(img)) 

          ? `<img src="${img}" loading="lazy" onclick="showModal('${img}')">` 

          : `<span style="color:#ccc;font-size:10px">NO IMG</span>`;

        

        const safeName = highlight(name);

        const modelMatch = name.match(/\{(.+?)\}/);

        const copyTextVal = modelMatch ? modelMatch[1] : name;

        const copyLabel = modelMatch ? "å‹ç•ª" : "å";



        const prices = [

          {l:'A', v:pA}, {l:'A-', v:pAm}, {l:'B', v:pB}, {l:'C', v:pC}, {l:'D', v:pD}

        ];

        let pGrid = '';

        prices.forEach(p => {

          const raw = p.v; 

          const val = fmtPrice(raw);

          const clickAttr = (raw && !isNaN(raw)) ? `onclick="copyText('${raw}', 'Â¥${Number(raw).toLocaleString()}')"` : "";

          const cls = (raw && !isNaN(raw)) ? "clickable-price" : "";

          pGrid += `<div class="kp-item" ${clickAttr}><span class="kp-label">${p.l}</span><span class="kp-val ${!raw?'price-empty':''} ${cls}">${val}</span></div>`;

        });



        const rushVal = fmtPrice(pRush);

        const rushClick = (pRush && !isNaN(pRush)) ? `onclick="copyText('${pRush}', 'ãƒ©ãƒƒã‚·ãƒ¥ä¾¡æ ¼')"` : "";

        const rushDisplay = (pRush) 

          ? `<div class="rush-row" ${rushClick}><span class="rush-label">ğŸ”¥ ã‚«ãƒ¼ãƒ‰ãƒ©ãƒƒã‚·ãƒ¥ (A)</span><span class="rush-val price clickable-price">${rushVal}</span></div>`

          : ``;



        html += `

          <div class="card">

            <div class="card-img">${imgTag}</div>

            <div class="card-body">

              <div class="card-title">${safeName}<span class="btn-copy" onclick="copyText('${copyTextVal.replace(/'/g,"\\'")}','${copyLabel}ã‚³ãƒ”ãƒ¼')">${copyLabel}</span></div>

              <div class="king-prices">${pGrid}</div>

            </div>

            ${rushDisplay}

          </div>

        `;

      });

      container.innerHTML = html;

    }



    function renderDesktop(rows){

      const container = document.getElementById('tableView');

      if(window.innerWidth < 768) { container.innerHTML = ""; return; }



      let html = `<table class="res-tbl"><thead><tr>`;

      const headers = [

        {n:"ã‚«ãƒ¼ãƒ‰å", w:"auto"}, {n:"ç”»åƒ", w:"70px"},

        {n:"çŠ¶æ…‹A", w:""}, {n:"çŠ¶æ…‹A-", w:""}, {n:"çŠ¶æ…‹B", w:""}, {n:"çŠ¶æ…‹C", w:""}, {n:"çŠ¶æ…‹D", w:""},

        {n:"ãƒ©ãƒƒã‚·ãƒ¥A", w:"", cls:"rush-header"}

      ];

      headers.forEach(h => html += `<th class="${h.cls||''}" width="${h.w}">${h.n}</th>`);

      html += `</tr></thead><tbody>`;



      rows.forEach(r => {

        const [name, img, pA, pAm, pB, pC, pD, pRush] = r;

        const imgTag = (img && /^http/.test(img)) ? `<img class="tbl-thumb" src="${img}" onclick="showModal('${img}')">` : "";

        

        const modelMatch = name.match(/\{(.+?)\}/);

        const copyTextVal = modelMatch ? modelMatch[1] : name;

        const copyLabel = modelMatch ? "å‹ç•ª" : "å";

        const copyBtn = `<span class="btn-copy" onclick="copyText('${copyTextVal.replace(/'/g,"\\'")}','${copyLabel}ã‚³ãƒ”ãƒ¼')">${copyLabel}</span>`;



        const mkPriceTd = (val, extraCls="") => {

           if(val && !isNaN(val)) return `<td class="price clickable-price ${extraCls}" onclick="copyText('${val}','Â¥${Number(val).toLocaleString()}')">${fmtPrice(val)}</td>`;

           return `<td class="price ${extraCls}">${fmtPrice(val)}</td>`;

        };



        html += `<tr>

          <td>${highlight(name)}${copyBtn}</td>

          <td>${imgTag}</td>

          ${mkPriceTd(pA)} ${mkPriceTd(pAm)} ${mkPriceTd(pB)} ${mkPriceTd(pC)} ${mkPriceTd(pD)}

          ${mkPriceTd(pRush, "rush-col")}

        </tr>`;

      });

      html += `</tbody></table>`;

      container.innerHTML = html;

    }



    function renderPager(curr, max){

      const p = document.getElementById('pager');

      if(max <= 1) { p.innerHTML = ""; return; }

      const makeBtn = (lbl, target, dis) => `<btn onclick="state.page=${target};render();window.scrollTo({top:0,behavior:'smooth'})" class="${dis?'disabled':''}">${lbl}</btn>`;

      p.innerHTML = makeBtn("Â«", 1, curr===1) + makeBtn("â€¹", curr-1, curr===1) + 

                    `<span style="display:flex;align-items:center;font-size:14px;color:#666;">${curr} / ${max}</span>` +

                    makeBtn("â€º", curr+1, curr===max) + makeBtn("Â»", max, curr===max);

    }



    function fmtPrice(v){ return (v === "" || v == null) ? "-" : (isNaN(v) ? v : `<span class="price-yen">Â¥</span>${Number(v).toLocaleString()}`); }

    function highlight(str){

      if(!str) return "";

      let html = String(str);

      [...state.terms.andTerms, ...state.terms.orTerms].forEach(k => {

        if(k) html = html.replace(new RegExp(k.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"), "gi"), m => `<mark>${m}</mark>`);

      });

      return html;

    }

    function parseQuery(raw){

      const n = (raw||"").replace(/[\u3041-\u3096]/g,c=>String.fromCharCode(c.charCodeAt(0)+0x60)).toLowerCase().trim();

      if(!n) return {andTerms:[], orTerms:[]};

      if(n.includes('|')) return {andTerms:[], orTerms:n.split('|').map(s=>s.trim()).filter(Boolean)};

      return {andTerms:n.split(/\s+/).map(s=>s.trim()).filter(Boolean), orTerms:[]};

    }

    

    function getInitialGroup(name){

      const c = (name||"").charAt(0);

      if(/[ã‚-ãŠã‚¢-ã‚ªãƒ´]/.test(c)) return 'A'; 

      if(/[ã‹-ã”ã‚«-ã‚´]/.test(c)) return 'K'; 

      if(/[ã•-ãã‚µ-ã‚¾]/.test(c)) return 'S'; 

      if(/[ãŸ-ã©ã‚¿-ãƒ‰]/.test(c)) return 'T'; 

      if(/[ãª-ã®ãƒŠ-ãƒ]/.test(c)) return 'N'; 

      if(/[ã¯-ã½ãƒ-ãƒ]/.test(c)) return 'H'; 

      if(/[ã¾-ã‚‚ãƒ-ãƒ¢]/.test(c)) return 'M'; 

      if(/[ã‚„-ã‚ˆãƒ¤-ãƒ¨]/.test(c)) return 'Y'; 

      if(/[ã‚‰-ã‚ãƒ©-ãƒ­]/.test(c)) return 'R'; 

      if(/[ã‚-ã‚“ãƒ¯-ãƒ³]/.test(c)) return 'W'; 

      return 'MISC';

    }



    function buildInitialBar(){

      const bar = document.getElementById('initialBar');

      bar.innerHTML = "";

      INITIALS.forEach(i => {

        const d = document.createElement('div');

        d.className = `chip ${state.initialKey===i.k ? 'active' : ''}`;

        d.innerText = i.l;

        d.onclick = () => { state.initialKey = i.k; buildInitialBar(); render(); };

        bar.appendChild(d);

      });

    }



    function toggleSort(){

      const lbl = document.getElementById('sortLabel');

      const chip = document.getElementById('sortIcon').parentElement;

      if(state.sort.idx === 0){

        state.sort = { idx: 2, dir: 'desc' }; lbl.innerText = "ä¾¡æ ¼é †(é«˜)"; chip.classList.add('active');

      } else {

        state.sort = { idx: 0, dir: 'asc' }; lbl.innerText = "æ¨™æº–(åå‰é †)"; chip.classList.remove('active');

      }

      render();

    }



    function copyKeyword(){

      const val = document.getElementById('keyword').value;

      if(!val) return copyText(" ", "ç©ºã§ã™");

      copyText(val, "æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ");

    }



    function copyText(txt, msg){

      navigator.clipboard.writeText(txt).then(() => {

        const t = document.getElementById('toast');

        document.getElementById('toastMsg').innerText = msg;

        t.classList.add('show');

        setTimeout(() => t.classList.remove('show'), 2000);

      });

    }

    function showModal(src){

      document.getElementById('modalImage').src = src;

      document.getElementById('modal').style.display = 'flex';

    }

    

    let resizeTimer;

    window.addEventListener('resize', () => {

      clearTimeout(resizeTimer);

      resizeTimer = setTimeout(() => render(), 200);

    });

  </script>

</body>

</html>

